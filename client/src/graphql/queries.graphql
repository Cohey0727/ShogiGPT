query Health {
  health {
    status
    timestamp
  }
}

query GetMatches {
  matches(orderBy: { createdAt: DESC }) {
    id
    createdAt
    updatedAt
    status
    playerSente
    playerGote
    senteType
    goteType
    matchStates(orderBy: { index: ASC }) {
      createdAt
      matchId
      index
      moveNotation
      sfen
      thinkingTime
    }
    chatMessages(orderBy: { createdAt: ASC }) {
      id
      createdAt
      matchId
      role
      contents
      metadata
    }
  }
}

query GetMatch($matchId: String!) {
  matchesByPk(id: $matchId) {
    id
    createdAt
    updatedAt
    status
    playerSente
    playerGote
    senteType
    goteType
    matchStates(orderBy: { index: ASC }) {
      createdAt
      matchId
      index
      moveNotation
      sfen
      thinkingTime
    }
  }
}

query GetChatMessages($matchId: String!) {
  chatMessages(
    where: { matchId: { _eq: $matchId } }
    orderBy: { createdAt: ASC }
  ) {
    id
    createdAt
    matchId
    role
    contents
    metadata
  }
}

subscription SubscribeChatMessages($matchId: String!) {
  chatMessages(
    where: { matchId: { _eq: $matchId } }
    orderBy: { createdAt: ASC }
  ) {
    id
    createdAt
    matchId
    role
    contents
    metadata
    isPartial
  }
}

subscription SubscribeMatchStates($matchId: String!) {
  matchStates(
    where: { matchId: { _eq: $matchId } }
    orderBy: { index: ASC }
  ) {
    createdAt
    matchId
    index
    moveNotation
    sfen
    thinkingTime
    evaluation {
      id
      sfen
      engineName
      variations
      createdAt
      updatedAt
    }
  }
}

mutation StartMatch(
  $id: String
  $playerSente: String
  $playerGote: String
  $senteType: PlayerType!
  $goteType: PlayerType!
) {
  startMatch(
    input: {
      id: $id
      playerSente: $playerSente
      playerGote: $playerGote
      senteType: $senteType
      goteType: $goteType
    }
  ) {
    id
    createdAt
    updatedAt
    status
    playerSente
    playerGote
    senteType
    goteType
  }
}

mutation SendChatMessage($matchId: String!, $content: String!) {
  sendChatMessage(input: { matchId: $matchId, content: $content }) {
    userMessage {
      id
      matchId
      role
      contents {
        ... on MarkdownContent {
          type
          content
        }
        ... on BestMoveContent {
          type
          bestmove
          variations {
            move
            scoreCp
            scoreMate
            depth
            nodes
            pv
          }
          timeMs
          engineName
        }
      }
      createdAt
    }
    assistantMessage {
      id
      matchId
      role
      contents {
        ... on MarkdownContent {
          type
          content
        }
        ... on BestMoveContent {
          type
          bestmove
          variations {
            move
            scoreCp
            scoreMate
            depth
            nodes
            pv
          }
          timeMs
          engineName
        }
      }
      createdAt
    }
  }
}

mutation InsertMatchState(
  $matchId: String!
  $index: Int!
  $moveNotation: String
  $sfen: String!
  $thinkingTime: Int
) {
  insertMatchStatesOne(
    object: {
      matchId: $matchId
      index: $index
      moveNotation: $moveNotation
      sfen: $sfen
      thinkingTime: $thinkingTime
    }
  ) {
    matchId
    index
    moveNotation
    sfen
    thinkingTime
    createdAt
  }
}

mutation EvaluateMatchState($input: EvaluateMatchStateInput!) {
  evaluateMatchState(input: $input) {
    type
    bestmove
    variations {
      move
      scoreCp
      scoreMate
      depth
      nodes
      pv
    }
    timeMs
    engineName
  }
}
