query Health {
  health {
    status
    timestamp
  }
}

query GetMatches {
  matches(orderBy: { createdAt: DESC }) {
    id
    createdAt
    updatedAt
    status
    playerSente
    playerGote
    senteType
    goteType
    matchStates(orderBy: { index: ASC }) {
      createdAt
      matchId
      index
      usiMove
      sfen
      thinkingTime
    }
    chatMessages(orderBy: { createdAt: ASC }) {
      id
      createdAt
      matchId
      role
      contents
      metadata
    }
  }
}

query GetMatch($matchId: String!) {
  matchesByPk(id: $matchId) {
    id
    createdAt
    updatedAt
    status
    playerSente
    playerGote
    senteType
    goteType
    matchStates(orderBy: { index: ASC }) {
      createdAt
      matchId
      index
      usiMove
      sfen
      thinkingTime
    }
  }
}

subscription SubscribeChatMessages($matchId: String!) {
  chatMessages(where: { matchId: { _eq: $matchId } }, orderBy: { createdAt: ASC }) {
    id
    createdAt
    updatedAt
    matchId
    role
    contents
    metadata
    isPartial
  }
}

subscription SubscribeChatMessagesStream($matchId: String!, $cursor: timestamp!) {
  chatMessagesStream(
    batchSize: 10
    cursor: { initialValue: { updatedAt: $cursor }, ordering: ASC }
    where: { matchId: { _eq: $matchId } }
  ) {
    id
    createdAt
    updatedAt
    matchId
    role
    contents
    metadata
    isPartial
  }
}

subscription SubscribeMatchStates($matchId: String!) {
  matchStates(where: { matchId: { _eq: $matchId } }, orderBy: { index: ASC }) {
    createdAt
    matchId
    index
    usiMove
    sfen
    thinkingTime
  }
}

mutation StartMatch(
  $id: String
  $playerSente: String
  $playerGote: String
  $senteType: PlayerType!
  $goteType: PlayerType!
) {
  startMatch(
    input: {
      id: $id
      playerSente: $playerSente
      playerGote: $playerGote
      senteType: $senteType
      goteType: $goteType
    }
  ) {
    id
    createdAt
    updatedAt
    status
    playerSente
    playerGote
    senteType
    goteType
  }
}

mutation SendChatMessage($matchId: String!, $content: String!, $aiPersonality: AiPersonality) {
  sendChatMessage(input: { matchId: $matchId, content: $content, aiPersonality: $aiPersonality }) {
    success
  }
}

query GetMatchEvaluations($matchId: String!) {
  matchEvaluations(matchId: $matchId) {
    moveIndex
    scoreCp
    scoreMate
  }
}

mutation RewindMatch($matchId: String!, $toIndex: Int!) {
  rewindMatch(input: { matchId: $matchId, toIndex: $toIndex }) {
    id
    createdAt
    updatedAt
    status
    playerSente
    playerGote
    senteType
    goteType
  }
}

mutation ForkMatch($matchId: String!, $fromIndex: Int!) {
  forkMatch(input: { matchId: $matchId, fromIndex: $fromIndex }) {
    id
    createdAt
    updatedAt
    status
    playerSente
    playerGote
    senteType
    goteType
  }
}
