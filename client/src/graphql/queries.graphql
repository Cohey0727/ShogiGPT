query Health {
  health {
    status
    timestamp
  }
}

query GetMatches {
  matches(orderBy: { createdAt: DESC }) {
    id
    createdAt
    updatedAt
    status
    playerSente
    playerGote
    senteType
    goteType
    matchStates(orderBy: { index: ASC }) {
      createdAt
      matchId
      index
      moveNotation
      player
      sfen
      thinkingTime
    }
    chatMessages(orderBy: { createdAt: ASC }) {
      id
      createdAt
      matchId
      role
      contents
      metadata
    }
  }
}

query GetMatch($matchId: String!) {
  matchesByPk(id: $matchId) {
    id
    createdAt
    updatedAt
    status
    playerSente
    playerGote
    senteType
    goteType
    matchStates(orderBy: { index: ASC }) {
      createdAt
      matchId
      index
      moveNotation
      player
      sfen
      thinkingTime
    }
  }
}

query GetChatMessages($matchId: String!) {
  chatMessages(
    where: { matchId: { _eq: $matchId } }
    orderBy: { createdAt: ASC }
  ) {
    id
    createdAt
    matchId
    role
    contents
    metadata
  }
}

subscription SubscribeChatMessages($matchId: String!) {
  chatMessages(
    where: { matchId: { _eq: $matchId } }
    orderBy: { createdAt: ASC }
  ) {
    id
    createdAt
    matchId
    role
    contents
    metadata
    isPartial
  }
}

mutation CreateMatch(
  $id: String
  $playerSente: String
  $playerGote: String
  $senteType: PlayerType
  $goteType: PlayerType
) {
  createMatch(
    input: {
      id: $id
      playerSente: $playerSente
      playerGote: $playerGote
      senteType: $senteType
      goteType: $goteType
    }
  ) {
    id
    createdAt
    updatedAt
    status
    playerSente
    playerGote
    senteType
    goteType
  }
}

mutation SendChatMessage($matchId: String!, $content: String!) {
  sendChatMessage(input: { matchId: $matchId, content: $content }) {
    userMessage {
      id
      matchId
      role
      contents {
        ... on MarkdownContent {
          type
          content
        }
        ... on BestMoveContent {
          type
          move
          evaluation
          depth
        }
      }
      createdAt
    }
    assistantMessage {
      id
      matchId
      role
      contents {
        ... on MarkdownContent {
          type
          content
        }
        ... on BestMoveContent {
          type
          move
          evaluation
          depth
        }
      }
      createdAt
    }
  }
}

mutation SaveMatchStateAndGetCandidates($input: SaveMatchStateInput!) {
  saveMatchStateAndGetCandidates(input: $input) {
    matchState {
      matchId
      index
      moveNotation
      player
      sfen
      thinkingTime
      createdAt
    }
    candidates {
      move
      scoreCp
      scoreMate
      depth
      nodes
      pv
    }
  }
}

mutation InsertMatchState(
  $matchId: String!
  $index: Int!
  $moveNotation: String
  $player: Player!
  $sfen: String!
  $thinkingTime: Int
) {
  insertMatchStatesOne(
    object: {
      matchId: $matchId
      index: $index
      moveNotation: $moveNotation
      player: $player
      sfen: $sfen
      thinkingTime: $thinkingTime
    }
  ) {
    matchId
    index
    moveNotation
    player
    sfen
    thinkingTime
    createdAt
  }
}

mutation EvaluateMatchState($input: EvaluateMatchStateInput!) {
  evaluateMatchState(input: $input) {
    success
    matchStateId
    thinkingMessage {
      id
      matchId
      role
      contents {
        ... on MarkdownContent {
          type
          content
        }
        ... on BestMoveContent {
          type
          move
          evaluation
          depth
        }
      }
      isPartial
      createdAt
    }
  }
}
