type Query {
  health: Health!
}

type Mutation {
  sendChatMessage(input: SendChatMessageInput!): SendChatMessageResult!
  createMatch(input: CreateMatchInput!): Match!
  saveMatchStateAndGetCandidates(
    input: SaveMatchStateInput!
  ): SaveMatchStateResult!
  evaluateMatchState(input: EvaluateMatchStateInput!): EvaluateMatchStateResult!
}

type Health {
  status: String!
  timestamp: String!
}

"""
プレイヤータイプ（HUMAN または AI）
"""
scalar PlayerType

"""
Markdownコンテンツ
"""
type MarkdownContent {
  type: String!
  content: String!
}

"""
最善手コンテンツ（盤面解析結果）
"""
type BestMoveContent {
  type: String!
  """
  最善手（USI形式）
  """
  bestmove: String!
  """
  候補手リスト（MultiPV）
  """
  variations: [MoveVariation!]!
  """
  思考時間（ミリ秒）
  """
  timeMs: Int!
  """
  エンジン名
  """
  engineName: String!
}

"""
メッセージコンテンツのUnion型
"""
union MessageContent = MarkdownContent | BestMoveContent

"""
1つの候補手情報
"""
type MoveVariation {
  """
  指し手（USI形式）
  """
  move: String!
  """
  評価値（センチポーン）
  """
  scoreCp: Int
  """
  詰みまでの手数（プライ数）
  """
  scoreMate: Int
  """
  探索深さ
  """
  depth: Int!
  """
  探索ノード数
  """
  nodes: Int
  """
  読み筋（PV）
  """
  pv: [String!]
}

"""
チャットメッセージ送信リクエスト
"""
input SendChatMessageInput {
  """
  対局ID
  """
  matchId: String!
  """
  メッセージ内容
  """
  content: String!
}

"""
チャットメッセージ送信結果
"""
type SendChatMessageResult {
  """
  作成されたユーザーメッセージ
  """
  userMessage: ChatMessage!
  """
  AIアシスタントの応答メッセージ
  """
  assistantMessage: ChatMessage!
}

"""
チャットメッセージ
"""
type ChatMessage {
  """
  メッセージID
  """
  id: String!
  """
  対局ID
  """
  matchId: String!
  """
  メッセージ役割
  """
  role: String!
  """
  メッセージコンテンツ（Markdownや候補手などを含む配列）
  """
  contents: [MessageContent!]!
  """
  入力途中かどうか（AI応答待ち）
  """
  isPartial: Boolean!
  """
  作成日時
  """
  createdAt: String!
}

"""
対局作成リクエスト
"""
input CreateMatchInput {
  """
  対局ID（指定しない場合は自動生成）
  """
  id: String
  """
  先手のプレイヤー名
  """
  playerSente: String
  """
  後手のプレイヤー名
  """
  playerGote: String
  """
  先手のプレイヤータイプ
  """
  senteType: PlayerType
  """
  後手のプレイヤータイプ
  """
  goteType: PlayerType
}

"""
対局情報
"""
type Match {
  """
  対局ID
  """
  id: String!
  """
  作成日時
  """
  createdAt: String!
  """
  更新日時
  """
  updatedAt: String!
  """
  対局状況
  """
  status: String!
  """
  先手のプレイヤー名
  """
  playerSente: String
  """
  後手のプレイヤー名
  """
  playerGote: String
  """
  先手のプレイヤータイプ
  """
  senteType: PlayerType!
  """
  後手のプレイヤータイプ
  """
  goteType: PlayerType!
}

"""
対局状態保存リクエスト
"""
input SaveMatchStateInput {
  """
  対局ID
  """
  matchId: String!
  """
  局面番号（何手目か）
  """
  index: Int!
  """
  この局面に至った指し手（USI形式）
  """
  moveNotation: String
  """
  この盤面での手番プレイヤー（SENTE/GOTE）
  """
  player: String!
  """
  盤面（SFEN形式）
  """
  sfen: String!
  """
  消費時間（秒）
  """
  thinkingTime: Int
  """
  候補手の数（MultiPV、デフォルト: 3）
  """
  multipv: Int
  """
  思考時間（ミリ秒、デフォルト: 1000）
  """
  timeMs: Int
}

"""
対局状態保存結果
"""
type SaveMatchStateResult {
  """
  保存された対局状態
  """
  matchState: MatchState!
  """
  次の候補手リスト
  """
  candidates: [MoveVariation!]!
}

"""
対局状態
"""
type MatchState {
  """
  対局ID
  """
  matchId: String!
  """
  局面番号
  """
  index: Int!
  """
  指し手（USI形式）
  """
  moveNotation: String
  """
  手番プレイヤー
  """
  player: String!
  """
  盤面（SFEN形式）
  """
  sfen: String!
  """
  消費時間（秒）
  """
  thinkingTime: Int
  """
  作成日時
  """
  createdAt: String!
}

"""
対局状態評価リクエスト
"""
input EvaluateMatchStateInput {
  """
  対局ID
  """
  matchId: String!
  """
  局面番号
  """
  index: Int!
  """
  消費時間（秒）
  """
  thinkingTime: Int
  """
  候補手の数（MultiPV、デフォルト: 3）
  """
  multipv: Int
}

"""
対局状態評価結果
"""
type EvaluateMatchStateResult {
  """
  成功したかどうか
  """
  success: Boolean!
  """
  評価対象のMatchStateのID
  """
  matchStateId: String!
  """
  思考中を示すチャットメッセージ
  """
  thinkingMessage: ChatMessage!
}
